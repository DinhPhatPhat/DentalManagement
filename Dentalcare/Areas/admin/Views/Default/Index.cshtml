@using Dental.Help
@{
    ViewBag.Title = "Index";
    Layout = "~/Areas/admin/Views/Shared/MyLayout.cshtml";
}

<!-- Begin Page Content -->
<div class="container-fluid">

    <!-- Page Heading -->
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <h1 class="h3 mb-0 text-gray-800">Trang chủ quản lý</h1>
        <a href="#" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm">
            <i class="fas fa-download fa-sm text-white-50"></i> Generate Report
        </a>
    </div>

    <!-- Content Row -->
    <div class="row">

        <!-- Earnings (Monthly) Card Example -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-primary shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center ml-0 mr-0">
                        <div class="col mr-2">
                            <div class="text-md font-weight-bold text-primary text-uppercase mb-1">
                                Doanh thu trung bình (tháng)
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">
                                @Functions.FormatIntWithDots(ViewBag.averageRevenueMonths) VNĐ
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-dollar-sign fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Earnings (Monthly) Card Example -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-success shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center ml-0 mr-0">
                        <div class="col mr-2">
                            <div class="text-md font-weight-bold text-success text-uppercase mb-1">
                                Doanh thu trung bình (năm)
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">
                                @Functions.FormatIntWithDots(ViewBag.averageRevenueYears) VNĐ
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-dollar-sign fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Earnings (Monthly) Card Example -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-info shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center ml-0 mr-0">
                        <div class="col mr-2">
                            <div class="text-md font-weight-bold text-info text-uppercase mb-1">
                                Số lượng bệnh nhân
                                <div class="h5 mb-0 font-weight-bold text-gray-800">
                                    @ViewBag.bills.Count NGƯỜI
                                </div>
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-user fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pending Requests Card Example -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-warning shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center ml-0 mr-0">
                        <div class="col mr-2">
                            <div class="text-md font-weight-bold text-warning text-uppercase mb-1">
                                Số lượng vật liệu tồn kho
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">
                                @ViewBag.materials.Count VẬT LIỆU
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-cubes fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Content Row -->
        <!-- Content Row for Filters -->
        <!-- Kiểu thời gian -->
        <!--<div class="col-xl-4 col-md-6 mb-4">
            <div class="card shadow h-100 py-2">
                <div class="card-body">
                    <div class="form-group">
                        <label for="type_time">Kiểu thời gian</label>
                        <select class="form-control" id="type_time" name="type_time" onchange="handleChangeTypeTime()">
                            <option value="year">Năm</option>
                            <option value="quarter">Quý</option>
                            <option value="month">Tháng</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>-->

        <!-- Năm cụ thể -->
        <!--<div class="col-xl-4 col-md-6 mb-4">
            <div class="card shadow h-100 py-2">
                <div class="card-body">
                    <div class="form-group">
                        <label for="detail_year">Năm cụ thể</label>
                        <select class="form-control" id="detail_year" name="detail_year" onchange="handleChangeTypeTime()" disabled="">
                            @foreach (var year in ViewBag.yearList as List<string>)
                            {
                                <option value="@year">@year</option>
                            }
                        </select>
                    </div>
                </div>
            </div>
        </div>-->

        <!-- Loại đồ thị -->
        <!--<div class="col-xl-4 col-md-6 mb-4">
            <div class="card shadow h-100 py-2">
                <div class="card-body">
                    <div class="form-group">
                        <label for="type_chart">Loại đồ thị</label>
                        <select class="form-control" id="type_chart" name="type_chart" change="handleChangeTypeChart()">
                            <option value="line">Đường</option>
                            <option value="doughnut">Tròn</option>
                            <option value="bar">Cột</option>
                            <option value="bubble">Điểm</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>-->


        <!-- Area Chart -->
        <div class="col-12">
            <div class="card shadow mb-4">
                <!-- Card Header - Dropdown -->
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">Đồ thị</h6>
                </div>
                <!-- Card Body -->
                <div class="card-body">
                    <div class="chart-area">
                        <canvas class="my-4 h-100" id="myAreaChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
    @*<script type="text/javascript">
        var myChart;  // Global chart instance

        $(document).ready(function () {
            // Function to update the chart dynamically
            function updateChart(typeTime, year, chartType) {
                $.ajax({
                    url: '@Url.Action("GetRevenueData", "BillService")',  // Controller action URL
                    type: 'POST',
                    data: {
                        typeTime: typeTime,
                        year: year
                    },
                    success: function (response) {
                        // Update chart with new data
                        updateChartUI(chartType, response.labels, response.data);
                    },
                    error: function () {
                        alert('Something went wrong while fetching chart data.');
                    }
                });
            }

            // Function to update the chart UI
            function updateChartUI(chartType, labels, data) {
                var chart = document.getElementById("myAreaChart").getContext('2d');

                // If chart exists, destroy it before creating a new one
                if (myChart) {
                    myChart.destroy();
                }

                // Create or update chart based on type
                myChart = new Chart(chart, {
                    type: chartType,
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Doanh thu',
                            data: data,
                            backgroundColor: chartType === 'line' ? 'rgba(6,128,250,0.5)' : undefined,
                            borderColor: chartType === 'line' ? 'rgba(6,128,250,1)' : undefined,
                            borderWidth: 1
                        }]
                    },
                    options: {
                        plugins: {
                            title: {
                                display: true,
                                text: 'Biểu đồ thống kê',
                                font: { size: 18 }
                            },
                            datalabels: {
                                anchor: 'end',
                                align: 'end',
                                color: 'black',
                                font: { weight: 'bold', size: 12 },
                                formatter: function (value) {
                                    return value.toLocaleString();
                                }
                            }
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: 'Thời gian',
                                    font: { size: 16, weight: 'bold' }
                                }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: 'Doanh thu (VNĐ)',
                                    font: { size: 16, weight: 'bold' }
                                },
                                beginAtZero: true
                            }
                        }
                    }
                });
            }

            // Call function when page is ready to set the initial chart
            var typeTime = $('#type_time').val();
            var year = $('#detail_year').val();
            var chartType = $('#type_chart').val();
            updateChart(typeTime, year, chartType);

            // Update chart when the user selects a different option
            $('#type_time').change(function () {
                typeTime = $(this).val();
                year = $('#detail_year').val();
                chartType = $('#type_chart').val();
                $('#detail_year').prop('disabled', typeTime !== 'year');
                updateChart(typeTime, year, chartType);
            });

            $('#detail_year').change(function () {
                typeTime = $('#type_time').val();
                year = $(this).val();
                chartType = $('#type_chart').val();
                updateChart(typeTime, year, chartType);
            });

            $('#type_chart').change(function () {
                typeTime = $('#type_time').val();
                year = $('#detail_year').val();
                chartType = $(this).val();
                updateChart(typeTime, year, chartType);
            });
        });
    </script>*@
}
